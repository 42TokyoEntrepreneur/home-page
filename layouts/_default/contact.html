{{ define "main" }}
  <div class="flex flex-col items-center gap-6">
    <h1 class="text-4xl font-bold text-center">{{ i18n "contactUs" }}</h1>
    <p class="mt-2 text-lg text-center text-gray-200">
      {{ i18n "contactMessage" }}
    </p>
  </div>

  <div class="flex justify-center mx-5 mt-8">
    <div class="relative flex overflow-hidden rounded-lg shadow-md bg-base-100">
      <button
        id="externalFormTab"
        class="relative z-10 w-32 py-2 text-sm font-medium transition-all duration-300 tab focus:outline-none"
        onclick="toggleForm('external')">
        {{ i18n "externalForm" }}
      </button>
      <button
        id="internalFormTab"
        class="relative z-10 w-32 py-2 text-sm font-medium transition-all duration-300 tab focus:outline-none"
        onclick="toggleForm('internal')">
        {{ i18n "internalForm" }}
      </button>
      <div
        id="tabIndicator"
        class="absolute top-0 bottom-0 left-0 w-32 transition-transform duration-300 rounded-lg bg-primary"></div>
    </div>
  </div>

  <div class="container max-w-2xl mx-auto mt-5">
    <!-- 外向けフォーム -->
    <div
      id="externalFormContainer"
      class="p-8 mx-2 border border-white rounded-lg shadow-md">
      <h2 class="mb-6 text-2xl font-semibold text-white">
        {{ i18n "externalFormTitle" }}
      </h2>
      <form id="externalForm" method="POST">
        <div class="mb-4">
          <label class="block mb-2 text-sm font-medium text-white">
            {{ i18n "yourName" }}
          </label>
          <input
            type="text"
            name="name"
            class="w-full p-3 border rounded-lg input input-bordered focus:outline-none focus:ring focus:ring-primary"
            required />
        </div>
        <div class="mb-4">
          <label class="block mb-2 text-sm font-medium text-white">
            {{ i18n "yourEmail" }}
          </label>
          <input
            type="email"
            name="email"
            class="w-full p-3 border rounded-lg input input-bordered focus:outline-none focus:ring focus:ring-primary"
            required />
        </div>
        <div class="mb-6">
          <label class="block mb-2 text-sm font-medium text-white">
            {{ i18n "yourMessage" }}
          </label>
          <textarea
            name="message"
            class="w-full p-3 border rounded-lg textarea textarea-bordered focus:outline-none focus:ring focus:ring-primary"
            rows="5"
            required></textarea>
        </div>
        <div class="mb-6">
          <div
            class="cf-turnstile mx-auto sm:scale-100 sm:max-w-none scale-75 max-w-[85%]"
            data-sitekey="{{ getenv "TRUSTSITE_ID" }}"></div>
        </div>
        <button type="submit" class="w-full px-4 py-2 btn btn-primary">
          {{ i18n "submitButton" }}
        </button>
      </form>
    </div>

    <!-- ウチ向けフォーム -->
    <div
      id="internalFormContainer"
      class="hidden p-8 mx-2 border border-white rounded-lg shadow-md">
      <h2 class="mb-6 text-2xl font-semibold text-white">
        {{ i18n "internalFormTitle" }}
      </h2>
      <form id="internalForm" method="POST">
        <div class="mb-4">
          <label class="block mb-2 text-sm font-medium text-white">
            {{ i18n "yourName" }}
          </label>
          <input
            type="text"
            name="name"
            class="w-full p-3 border rounded-lg input input-bordered focus:outline-none focus:ring focus:ring-secondary"
            required />
        </div>
        <div class="mb-4">
          <label class="block mb-2 text-sm font-medium text-white">
            {{ i18n "yourIntraName" }}
          </label>
          <input
            type="text"
            name="intra_name"
            class="w-full p-3 border rounded-lg input input-bordered focus:outline-none focus:ring focus:ring-secondary"
            required />
        </div>
        <div class="mb-4">
          <label class="block mb-2 text-sm font-medium text-white">
            {{ i18n "yourEmail" }}
          </label>
          <input
            type="email"
            name="email"
            class="w-full p-3 border rounded-lg input input-bordered focus:outline-none focus:ring focus:ring-secondary"
            required />
        </div>
        <div class="mb-6">
          <label class="block mb-2 text-sm font-medium text-white">
            {{ i18n "yourMessage" }}
          </label>
          <textarea
            name="message"
            class="w-full p-3 border rounded-lg textarea textarea-bordered focus:outline-none focus:ring focus:ring-secondary"
            rows="5"
            required></textarea>
        </div>
        <div class="mb-6">
          <div
            class="cf-turnstile mx-auto sm:scale-100 sm:max-w-none scale-75 max-w-[85%]"
            data-sitekey="{{ getenv "TRUSTSITE_ID" }}"></div>
        </div>
        <button type="submit" class="w-full px-4 py-2 btn btn-secondary">
          {{ i18n "submitButton" }}
        </button>
      </form>
    </div>
  </div>

  <script>
    async function submitForm(formId, endpoint) {
      const form = document.getElementById(formId);
      if (!form) {
        console.error(`Form with ID "${formId}" not found.`);
        return;
      }

      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());

      // TrustSiteトークン取得
      const trustToken = form
        .querySelector(".cf-turnstile")
        .getAttribute("data-response");
      data.trustToken = trustToken;

      try {
        const response = await fetch(endpoint, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data),
        });

        if (response.ok) {
          alert("フォーム送信に成功しました！");
        } else {
          const error = await response.json();
          console.error("エラー内容:", error);
          alert("フォーム送信に失敗しました。再度お試しください。");
        }
      } catch (err) {
        console.error("エラーが発生しました:", err);
        alert("フォーム送信中に問題が発生しました。");
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      const externalForm = document.getElementById("externalForm");
      if (externalForm) {
        externalForm.addEventListener("submit", (event) => {
          event.preventDefault();
          submitForm(
            "externalForm",
            "https://contact-form-backend.wakamiya626.workers.dev/external",
          );
        });
      }

      const internalForm = document.getElementById("internalForm");
      if (internalForm) {
        internalForm.addEventListener("submit", (event) => {
          event.preventDefault();
          submitForm(
            "internalForm",
            "https://contact-form-backend.wakamiya626.workers.dev/internal",
          );
        });
      }
    });
  </script>
  <script
    src="https://challenges.cloudflare.com/turnstile/v0/api.js"
    async
    defer></script>
{{ end }}
